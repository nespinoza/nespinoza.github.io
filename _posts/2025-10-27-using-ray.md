---
layout: post
title: "Using the ray library"
date: 2025-10-27
---

As my first post --- and as a reminder to myself --- here's a quick set of code snippets to use `ray`, the python library that changed my life when it comes to multiprocessing in Python. Why use `ray` instead of `multiprocessing` --- I'll leave that to the plethora of posts online. Here, I simply state how to use `ray`

## Getting started

First of all, you'll need to install ray:

```python
pip install ray
```

Next, I'll assume you have `numpy` installed

## A dumb example

Suppose you have the following function that takes the square of a number:

```python
def get_square(x):
    return x**2
```

If you wanted to square all the values in an array `y` for the first `100` numbers, you would do:

```python
import numpy as np

n = 100
y = np.arange(n)
result = np.zeros(n)
for i in range(n):

    result[i] = get_square(y[i])
```

## Parallelizing with `ray`

Let's now parallelize this same dumb function with `ray`. To do this, you need to create a new function that will allow you to cast `ray`'s magic into it --- to do this, you simply [decorate the function](https://www.reddit.com/r/Python/comments/2lrhp5/comment/clxgkce/) as such:

```python
import ray

@ray.remote
def get_square2(x):
    return x**2
```

I have called this new magic function `get_square2` --- but of course, it could be called whatever I wanted. Next, we initialize `ray`, and define how many cpus we want to use; in this case, I'll use 4:

```python
ray.init(num_cpus = 4)
```

And now we run a `for` loop on which we save executions to our new `ray` function:

```python
all_results = []
for i in range(n):

    all_results.append( get_square2.remote(y[i]) )
```
This `for` loop has not actually ran any calculations. It just staged the calculations to be performed. The next step runs the calculations:

```python
ray_results = ray.get(all_results)
```

Note this gives back a _list_ with the results --- we could pass them back as an array as follows:

```python
result2 = np.zeros(n)
for i in range(n):
    
    result2[i] = ray_results[i]
```

Et voila!
You will note this `for` loop is actually blazing fast. Howver, this is a bIn my computer this took  This is because `ray` hasn't ran 
